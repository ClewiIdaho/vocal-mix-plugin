<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clean Vocal Mix</title>

<style>
body {
  background:#050b08;
  font-family: Inter, system-ui, sans-serif;
  display:flex;
  justify-content:center;
  padding:30px;
}

.plugin {
  width:340px;
  background:linear-gradient(180deg,#0b2f1a,#04140b);
  border-radius:20px;
  padding:18px;
  color:#e6fff1;
  box-shadow:0 20px 50px rgba(0,0,0,.6);
}

.cover {
  background:#0e3d23;
  border-radius:14px;
  height:180px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:44px;
  margin-bottom:12px;
}

label {
  font-size:12px;
  opacity:.8;
}

input[type=file] {
  width:100%;
  margin-bottom:12px;
}

.knob-wrap {
  text-align:center;
  margin:14px 0;
}

.knob {
  width:140px;
  height:140px;
  border-radius:50%;
  background:radial-gradient(circle at top,#1aff8c,#0b3f23);
  margin:auto;
  position:relative;
}

.knob::after {
  content:"";
  width:5px;
  height:38px;
  background:#fff;
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  border-radius:3px;
}

input[type=range] {
  width:100%;
}

.control {
  margin-top:12px;
}

button {
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#1aff8c;
  color:#003b1f;
  font-weight:700;
  cursor:pointer;
  margin-top:14px;
}

audio {
  width:100%;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="plugin">
  <div class="cover">ðŸŽ§</div>

  <label>Upload Song</label>
  <input type="file" id="file" accept="audio/*">

  <div class="knob-wrap">
    <label>Mix Amount</label>
    <div class="knob"></div>
    <input type="range" id="mix" min="0" max="100" value="40">
  </div>

  <div class="control">
    <label>Clarity</label>
    <input type="range" id="clarity" min="0" max="100" value="30">
  </div>

  <div class="control">
    <label>Punch</label>
    <input type="range" id="punch" min="0" max="100" value="50">
  </div>

  <button onclick="process()">Download Mixed Song</button>

  <audio id="player" controls></audio>
</div>

<script>
let ctx;

function process() {
  const file = document.getElementById("file").files[0];
  if (!file) return alert("Upload a song first");

  const mix = mixVal();
  const clarity = clarityVal();
  const punch = punchVal();

  ctx = new AudioContext();
  const reader = new FileReader();

  reader.onload = async () => {
    const buffer = await ctx.decodeAudioData(reader.result);
    const source = ctx.createBufferSource();
    source.buffer = buffer;

    const compressor = ctx.createDynamicsCompressor();
    compressor.threshold.value = -24;
    compressor.ratio.value = 2 + punch * 0.06;

    const eq = ctx.createBiquadFilter();
    eq.type = "peaking";
    eq.frequency.value = 3500;
    eq.gain.value = clarity * 0.08;

    const gain = ctx.createGain();
    gain.gain.value = 1 + mix * 0.01;

    const dest = ctx.createMediaStreamDestination();

    source.connect(compressor);
    compressor.connect(eq);
    eq.connect(gain);
    gain.connect(dest);
    gain.connect(ctx.destination);

    source.start();

    const mediaRecorder = new MediaRecorder(dest.stream);
    let chunks = [];

    mediaRecorder.ondataavailable = e => chunks.push(e.data);
    mediaRecorder.onstop = () => {
      const blob = new Blob(chunks, { type: "audio/webm" });
      const url = URL.createObjectURL(blob);
      document.getElementById("player").src = url;

      const a = document.createElement("a");
      a.href = url;
      a.download = "mixed_song.webm";
      a.click();
    };

    mediaRecorder.start();
    setTimeout(() => mediaRecorder.stop(), buffer.duration * 1000);
  };

  reader.readAsArrayBuffer(file);
}

const mixVal = () => document.getElementById("mix").value;
const clarityVal = () => document.getElementById("clarity").value;
const punchVal = () => document.getElementById("punch").value;
</script>

</body>
</html>
