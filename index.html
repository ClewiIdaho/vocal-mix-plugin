<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vocal Mix Plugin</title>

<style>
:root {
  --accent:#1aff8c;
  --bg1:#0b2f1a;
  --bg2:#04140b;
}

body {
  margin:0;
  background:#000;
  font-family:Inter,system-ui,sans-serif;
  display:flex;
  justify-content:center;
  padding:20px;
}

.plugin {
  width:100%;
  max-width:380px;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  border-radius:22px;
  padding:18px;
  color:#eafff3;
  box-shadow:0 25px 60px rgba(0,0,0,.6);
}

/* HEADER */
.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}

.title {
  font-weight:600;
  font-size:14px;
}

.theme-dots span {
  width:12px;
  height:12px;
  border-radius:50%;
  display:inline-block;
  cursor:pointer;
  margin-left:6px;
}

/* LED */
.led {
  width:10px;
  height:10px;
  border-radius:50%;
  background:#123f2a;
}
.led.on {
  background:var(--accent);
  box-shadow:0 0 12px var(--accent);
}

/* COVER */
.cover {
  height:190px;
  border-radius:16px;
  background:rgba(255,255,255,.05);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:48px;
  margin:12px 0;
}

/* CONTROLS */
label {
  font-size:11px;
  opacity:.8;
}

input[type=file] {
  width:100%;
  margin-bottom:10px;
}

.knob-wrap {
  text-align:center;
  margin:14px 0;
}

.knob {
  width:130px;
  height:130px;
  border-radius:50%;
  background:radial-gradient(circle at top,#fff,var(--accent));
  margin:auto;
  position:relative;
  transition:transform .2s ease;
}

.knob::after {
  content:"";
  width:5px;
  height:36px;
  background:#000;
  position:absolute;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  border-radius:3px;
}

input[type=range] {
  width:100%;
}

.control {
  margin-top:10px;
}

button {
  width:100%;
  margin-top:14px;
  padding:12px;
  border:none;
  border-radius:14px;
  background:var(--accent);
  color:#002b18;
  font-weight:700;
  cursor:pointer;
}

audio {
  width:100%;
  margin-top:10px;
}

/* DESKTOP */
@media(min-width:900px){
  body { padding:40px }
}
</style>
</head>

<body>

<div class="plugin">
  <div class="header">
    <div class="title">NOW PLAYING</div>
    <div style="display:flex;align-items:center">
      <div class="led" id="led"></div>
      <div class="theme-dots">
        <span style="background:#1aff8c" onclick="setTheme('#1aff8c','#0b2f1a','#04140b')"></span>
        <span style="background:#5da9ff" onclick="setTheme('#5da9ff','#0b1e2f','#040d14')"></span>
        <span style="background:#b67cff" onclick="setTheme('#b67cff','#1d0b2f','#0b0414')"></span>
        <span style="background:#ff6b6b" onclick="setTheme('#ff6b6b','#2f0b0b','#140404')"></span>
      </div>
    </div>
  </div>

  <div class="cover">ðŸŽ§</div>

  <label>Upload Song</label>
  <input type="file" id="file" accept="audio/*">

  <div class="knob-wrap">
    <label>Mix</label>
    <div class="knob" id="knob"></div>
    <input type="range" id="mix" min="0" max="100" value="40">
  </div>

  <div class="control">
    <label>Clarity</label>
    <input type="range" id="clarity" min="0" max="100" value="30">
  </div>

  <div class="control">
    <label>Punch</label>
    <input type="range" id="punch" min="0" max="100" value="50">
  </div>

  <button onclick="process()">Download Mixed Song</button>

  <audio id="player" controls></audio>
</div>

<script>
const knob = document.getElementById("knob");
const mixSlider = document.getElementById("mix");
const led = document.getElementById("led");

// Rotate knob
mixSlider.oninput = () => {
  const deg = -135 + (mixSlider.value / 100) * 270;
  knob.style.transform = `rotate(${deg}deg)`;
};

// Theme switcher
function setTheme(accent,bg1,bg2){
  document.documentElement.style.setProperty("--accent",accent);
  document.documentElement.style.setProperty("--bg1",bg1);
  document.documentElement.style.setProperty("--bg2",bg2);
}

// Audio curve
const curve = v => Math.pow(v/100,1.5);

function process(){
  const file = document.getElementById("file").files[0];
  if(!file) return alert("Upload a song first");

  const mix = curve(mixSlider.value);
  const clarity = curve(document.getElementById("clarity").value);
  const punch = curve(document.getElementById("punch").value);

  const ctx = new AudioContext();
  const reader = new FileReader();

  reader.onload = async () => {
    const buffer = await ctx.decodeAudioData(reader.result);
    const src = ctx.createBufferSource();
    src.buffer = buffer;

    const comp = ctx.createDynamicsCompressor();
    comp.threshold.value = -24;
    comp.ratio.value = 2 + punch * 6;

    const eq = ctx.createBiquadFilter();
    eq.type = "highshelf";
    eq.frequency.value = 3000;
    eq.gain.value = clarity * 10;

    const gain = ctx.createGain();
    gain.gain.value = 1 + mix * 0.4;

    const dest = ctx.createMediaStreamDestination();

    src.connect(comp);
    comp.connect(eq);
    eq.connect(gain);
    gain.connect(dest);
    gain.connect(ctx.destination);

    src.start();
    led.classList.add("on");

    const rec = new MediaRecorder(dest.stream);
    let chunks = [];

    rec.ondataavailable = e => chunks.push(e.data);
    rec.onstop = () => {
      led.classList.remove("on");
      const blob = new Blob(chunks,{type:"audio/webm"});
      const url = URL.createObjectURL(blob);
      document.getElementById("player").src = url;

      const a = document.createElement("a");
      a.href = url;
      a.download = "mixed_song.webm";
      a.click();
    };

    rec.start();
    setTimeout(()=>rec.stop(), buffer.duration * 1000);
  };

  reader.readAsArrayBuffer(file);
}
</script>

</body>
</html>
